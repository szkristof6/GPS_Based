require("dotenv").config();const{loginSchema:loginSchema}=require("../../schemas/user"),users=require("../../db/users"),bcrypt=require("bcrypt"),captcha=require("../captcha"),JWT_sign=require("../jwt");async function loginUser(e,s){try{if(!await captcha(e))return void s.send({status:"error",message:"Captcha failed!"});await loginSchema.validate(e.body);const r=await users.findOne({email:e.body.email});if(null==r)return void s.send({status:"error",message:"This account does not exist! Please sign in!"});if("email"!=r.login_method)return void s.send({status:"error",message:"Provider method was used for signin!"});if(await bcrypt.compare(e.body.password,r.password)){const e=JWT_sign(r);return void s.send({status:"success",token:e})}return void s.send({status:"error",message:"The password is incorrect!"})}catch(e){return void s.send(e)}}module.exports=loginUser;