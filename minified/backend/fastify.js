const fastify=require("fastify")({logger:!0});require("dotenv").config(),fastify.register(require("@fastify/cors")),fastify.register(require("@fastify/helmet"),{global:!0}),fastify.register(require("@fastify/jwt"),{secret:process.env.TOKEN_KEY}),fastify.register(import("@fastify/rate-limit"),{max:100,timeWindow:"1 minute"}),fastify.setErrorHandler((function(e,t,s){429===e.statusCode&&(s.code(429),e.message="You hit the rate limit! Slow down please!"),s.send(e)})),fastify.decorate("verify",(async function(e,t){try{await e.jwtVerify()}catch(e){t.send(e)}})),fastify.decorate("captcha",(async function(e,t){const s=`https://www.google.com/recaptcha/api/siteverify?secret=${process.env.CAPTCHA_SECRET}&response=${e.body.token}`;try{await fetch(s,{method:"get"}).then((e=>e.json()));return!0}catch(e){t.send(e)}})),module.exports=fastify;